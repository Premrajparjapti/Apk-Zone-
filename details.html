<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="details-page-title">Loading Details...</title> <!-- Title will be updated by JS -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"> <!-- For Icons -->

    <style>
        /* --- Base Styles (Dark Mode Default) --- */
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            background-color: #1a202c; /* Dark background */
            color: #e2e8f0; /* Light text */
            padding-top: 60px; /* Space for fixed header */
            padding-bottom: 20px; /* Space at the bottom */
            overflow-x: hidden; /* Prevent horizontal scroll */
            transition: background-color 0.3s ease, color 0.3s ease; /* Smooth mode transition */
        }

        .header {
            background-color: #2d3748; /* Slightly lighter dark */
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            position: fixed; /* Keep header at the top */
            top: 0;
            left: 0;
            width: 100%;
            z-index: 100; /* Stay above content */
            box-sizing: border-box; /* Include padding in width */
            transition: background-color 0.3s ease, color 0.3s ease; /* Smooth mode transition */
        }
         /* Hide Menu and Search icons on details page header as they are not used here */
         .header .left-section .icon,
         .header .right-section #search-toggle-icon {
             display: none;
         }

        .header .left-section {
            display: flex;
            align-items: center;
        }
        .header .logo {
            font-size: 1.2em; /* Adjusted font size for header */
            margin-right: 10px;
            color: #667eea; /* Example accent color */
            font-weight: 700;
        }
         .header .logo i { /* Style for Font Awesome Robot */
             color: #667eea;
             margin-right: 5px;
         }
        .header .title {
            display: flex;
            flex-direction: column;
        }
        .header .title h1 {
            font-size: 1em; /* Adjusted font size */
            margin: 0;
            color: inherit; /* Inherit color from header */
            font-weight: 700;
        }
         .header .title p {
             font-size: 0.7em; /* Adjusted font size */
             margin: 0;
             color: #a0aec0; /* Keep a softer color */
         }
        .header .right-section {
            display: flex;
            align-items: center;
        }
        .header .icon {
            font-size: 1.3em;
            margin-left: 15px;
            cursor: pointer;
            color: #a0aec0;
            transition: color 0.2s ease;
        }
         .header .icon:hover { color: #e2e8f0; }


        /* --- Main Content Styles (Details View) --- */
        .details-container { /* Use a class for the main content container */
            max-width: 800px; /* Slightly smaller container for details */
            margin: auto;
            padding: 20px;
            background-color: #2d3748; /* Dark background */
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s ease; /* Smooth mode transition */
        }

        #app-detail-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center; /* Center text within the content div */
        }

         /* Section titles like "App Details", "Download Details", "User Rating", etc. */
        .details-section-title {
            font-size: 1.4em;
            font-weight: bold;
            color: #fff; /* White color for titles */
            margin-top: 30px;
            margin-bottom: 15px;
            text-align: left; /* Align title to the left */
            width: 100%; /* Take full width */
            padding-left: 10px; /* Little padding from the edge */
            border-bottom: 1px solid #4a5568; /* Separator line */
            padding-bottom: 8px;
        }


        #app-detail-content > img { /* Style for the main app poster image */
            max-width: 200px; /* Larger image */
            height: auto;
            margin-bottom: 25px;
            border-radius: 12px;
            border: 1px solid #4a5568;
             box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); /* Responsive grid */
            gap: 20px;
            width: 100%; /* Take full width */
            margin-bottom: 20px;
        }

        .detail-item {
            background-color: #4a5568; /* Slightly lighter dark background for items */
            padding: 15px;
            border-radius: 8px;
            text-align: left; /* Align text to the left */
            display: flex;
            align-items: center;
        }

        .detail-item i {
            font-size: 1.5em;
            color: #48bb78; /* Green icon color */
            margin-right: 15px;
        }

        .detail-item .text {
             flex-grow: 1;
         }

         .detail-item .text .label {
             font-size: 0.8em;
             color: #a0aec0; /* Softer color for label */
             display: block; /* Label on its own line */
             margin-bottom: 4px;
         }

         .detail-item .text .value {
             font-size: 1em;
             color: #e2e8f0; /* Light text for value */
             font-weight: bold;
         }

        /* Specific styling for Google Play button if added */
         .google-play-btn-container {
             width: 100%; /* Take full width */
             text-align: center; /* Center the button */
             margin-top: 10px; /* Space above the button */
         }
         .google-play-btn {
             display: inline-block; /* Make it block for centering if needed, or inline-block */
             /* Add specific styles for Google Play image/button */
         }
         .google-play-btn img {
             height: 50px; /* Adjust height as needed */
             width: auto;
             cursor: pointer;
         }


         /* User Rating Styles */
         .user-rating-container {
             width: 100%;
             text-align: center;
             margin-bottom: 20px;
         }

         .stars {
             font-size: 1.8em;
             color: #f6e05e; /* Yellow stars */
             margin-right: 10px;
         }
         /* Styling for half stars using pseudo-elements or specific classes */
         /* Example using fas fa-star-half-alt for half star */
          .stars .fa-star-half-alt {
             position: relative; /* Required for pseudo-element positioning */
          }
          /* If using a full star icon and clipping for half */
          /*
           .stars .fa-star.half::before {
             content: '\f005'; // fa-star solid unicode
             position: absolute;
             left: 0;
             width: 50%; // Show only half
             overflow: hidden;
             color: #f6e05e; // Filled color
          }
          */
         .stars .fa-star {
             color: #a0aec0; /* Empty star color */
         }
          .stars .filled {
             color: #f6e05e; /* Filled star color */
          }

         .rating-count {
             font-size: 1em;
             color: #a0aec0;
         }


        /* Download Button Styles */
        #detail-download-btn {
             background-color: #48bb78; /* Green */
             color: white;
             border: none;
             padding: 12px 30px;
             border-radius: 8px;
             cursor: pointer;
             font-size: 1.2em;
             font-weight: bold;
             margin-top: 20px;
             transition: background-color 0.3s ease;
             display: inline-block; /* Default display */
         }
         #detail-download-btn:hover { background-color: #38a169; }


         /* Introduction / Conclusion / About Section */
         .about-section, .introduction-section, .conclusion-section {
             width: 100%;
             margin-top: 30px;
             text-align: left;
         }
         .about-content, .introduction-content, .conclusion-content {
             background-color: #4a5568; /* Item background */
             padding: 15px;
             border-radius: 8px;
             line-height: 1.6;
             color: #cbd5e0;
             margin-top: 15px;
             word-wrap: break-word; /* Ensure long text wraps */
         }
         .about-content p, .introduction-content p, .conclusion-content p {
             margin: 0; /* Remove default paragraph margin */
         }


         /* MOD Features */
         .features-section {
             width: 100%;
             margin-top: 30px;
             text-align: left;
         }
         .features-list {
             list-style: none;
             padding: 0;
             margin-top: 15px;
         }
         .features-list li {
             background-color: #4a5568; /* Item background */
             padding: 12px 15px;
             margin-bottom: 8px;
             border-radius: 6px;
             display: flex;
             align-items: flex-start; /* Align icon and text */
             color: #cbd5e0;
         }
         .features-list li i {
             color: #f6e05e; /* Yellow checkmark */
             margin-right: 10px;
             font-size: 1.1em;
             margin-top: 3px; /* Vertically align icon */
         }


         /* Screenshot Gallery Styles */
         .screenshot-gallery {
             width: 100%;
             margin-top: 15px; /* Spacing below title */
             background-color: #4a5568; /* Background like other content blocks */
             padding: 15px;
             border-radius: 8px;
             display: flex; /* Use flexbox for layout */
             flex-wrap: wrap; /* Allow images to wrap */
             gap: 10px; /* Space between images */
             justify-content: center; /* Center images if they don't fill the row */
         }

         .screenshot-gallery img {
             width: 150px; /* Fixed width for consistency */
             height: auto; /* Maintain aspect ratio */
             border-radius: 6px;
             border: 1px solid #5a67d8; /* Border color */
             box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
             object-fit: cover; /* Crop image if needed to fit width */
             cursor: pointer; /* Indicate clickable */
             transition: transform 0.2s ease, box-shadow 0.2s ease;
         }

         .screenshot-gallery img:hover {
              transform: scale(1.05); /* Slightly enlarge on hover */
              box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
         }

         .screenshot-gallery .info-message {
              width: 100%; /* Take full width to center message */
              text-align: center;
              font-style: normal;
              color: #a0aec0;
         }

         /* --- Modal Gallery Styles --- */
         #gallery-modal {
             display: none; /* Hidden by default */
             position: fixed; /* Stay in place */
             z-index: 1001; /* Sit on top (should be higher than header) */
             left: 0;
             top: 0;
             width: 100%; /* Full width */
             height: 100%; /* Full height */
             overflow: auto; /* Enable scroll if needed */
             background-color: rgba(0, 0, 0, 0.9); /* Black background with opacity */
             justify-content: center; /* Center content horizontally */
             align-items: center; /* Center content vertically */
             flex-direction: column; /* Stack elements vertically */
         }

         #modal-content {
             position: relative; /* Needed for positioning children like close button */
             display: flex;
             justify-content: center;
             align-items: center;
             max-width: 95%; /* Max width of content */
             max-height: 95%; /* Max height of content */
         }

         #modal-image {
             display: block; /* Remove extra space below image */
             max-width: 90vw; /* Max width of the image based on viewport */
             max-height: 90vh; /* Max height of the image based on viewport */
             object-fit: contain; /* Scale image to fit without stretching */
             border-radius: 8px;
             box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
         }

         .modal-nav-btn {
             position: absolute;
             top: 50%;
             transform: translateY(-50%);
             font-size: 2.5em; /* Larger icons */
             color: #e2e8f0; /* Light color */
             cursor: pointer;
             padding: 10px;
             transition: color 0.3s ease;
             user-select: none; /* Prevent text selection */
             background-color: rgba(0,0,0,0.3); /* Slight background for click area */
             border-radius: 50%;
             line-height: 1; /* Adjust line height to vertically center icon */
         }

         .modal-nav-btn:hover {
             color: #ffffff; /* White on hover */
             background-color: rgba(0,0,0,0.5);
         }

         #prev-screenshot-btn {
             left: 15px;
         }

         #next-screenshot-btn {
             right: 15px;
         }

         #modal-close-btn {
             position: absolute;
             top: 15px; /* Space from top */
             right: 15px; /* Space from right */
             font-size: 2em; /* Close icon size */
             color: #e2e8f0;
             cursor: pointer;
             transition: color 0.3s ease;
             z-index: 1002; /* Ensure close button is above image/nav buttons */
         }
          #modal-close-btn:hover { color: #ffffff; }

         #image-counter {
             color: #e2e8f0;
             font-size: 1em;
             margin-top: 10px; /* Space below image */
         }


         /* Related Posts Section (Placeholder UI) */
         .related-posts-section {
              width: 100%;
             margin-top: 30px;
             text-align: left;
         }
         .related-posts-grid-placeholder { /* Reusing content style for placeholder grid area */
             display: grid; /* Use grid for placeholder layout */
             grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
             gap: 20px;
             margin-top: 15px;
              background-color: #4a5568;
              padding: 15px;
              border-radius: 8px;
              text-align: center;
              font-style: italic;
              color: #cbd5e0;
         }
         /* Styles for actual related posts grid */
         .related-posts-grid {
             display: grid;
             grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
             gap: 20px;
             margin-top: 15px;
         }
          .related-post-item {
              background-color: #2d3748; /* Card background */
              border-radius: 8px;
              overflow: hidden; /* Ensures rounded corners on image */
              box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
              cursor: pointer;
              transition: transform 0.3s ease, box-shadow 0.3s ease;
              text-align: center; /* Center image and text */
              display: flex;
              flex-direction: column;
              justify-content: space-between; /* Push footer down */
          }
           .related-post-item:hover {
               transform: translateY(-5px); /* Slight lift effect */
               box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
           }
          .related-post-item img {
              max-width: 100px; /* Smaller image in related item */
              height: auto;
              border-bottom: 1px solid #4a5568;
              margin: 15px auto 10px auto; /* Center image and add margin */
              border-radius: 8px; /* Keep rounded corners */
               box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
          }
          .related-post-item .item-details {
              padding: 0px 15px 15px 15px; /* Padding around text */
              flex-grow: 1; /* Allow details to take space */
              display: flex;
              flex-direction: column;
              align-items: center; /* Center text elements */
          }
          .related-post-item .item-details h3 {
              font-size: 1em; /* Smaller title */
              margin: 0 0 5px 0;
              color: #e2e8f0; /* Light text */
              font-weight: 500;
              text-align: center;
          }
           .related-post-item .category {
               font-size: 0.8em;
               color: #9f7aea; /* Purple */
               margin-bottom: 8px;
               text-align: center;
           }
          .related-post-item .version-size {
              font-size: 0.75em;
              color: #a0aec0; /* Softer color */
               width: 100%; /* Ensure spans wrap correctly */
               display: flex; /* Use flex for version/size */
               justify-content: space-around; /* Space out version and size */
               margin-top: auto; /* Push version/size to the bottom */
          }
          .related-post-item .version-size span i {
              margin-right: 3px;
              color: #48bb78; /* Green icon */
          }


        /* Back Button at the bottom */
         .bottom-buttons {
             width: 100%;
             text-align: center;
             margin-top: 40px;
         }
         .bottom-buttons .back-btn {
             background-color: red; /* Gray */
             color: white;
             padding: 10px 20px;
             border: none;
             border-radius: 6px;
             cursor: pointer;
             font-size: 1em;
             transition: background-color 0.3s ease;
         }
         .bottom-buttons .back-btn:hover { background-color: #4a5568; }

        .loading-message, .error-message {
            text-align: center;
            margin-top: 50px; /* More space if content failed to load */
            font-size: 1.2em;
            color: #a0aec0;
        }
        .error-message { color: #fc8181; } /* Red */

         /* --- Light Mode Styles --- */
         body.light-mode {
             background-color: #eef2f7; /* Light background */
             color: #333; /* Dark text */
         }

         .light-mode .header {
             background-color: #ffffff; /* White header */
             color: #333;
             box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
         }

         .light-mode .header .title p { color: #555; } /* Darker soft color */
         .light-mode .header .icon { color: #555; }
         .light-mode .header .icon:hover { color: #333; }

         .light-mode .details-container {
             background-color: #ffffff; /* White background */
             color: #333;
             border: 1px solid #e0e0e0;
             box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
         }

         .light-mode .details-section-title {
             color: #333; /* Dark color for titles */
             border-bottom-color: #ccc; /* Lighter separator */
         }

         .light-mode .details-container h2 { color: inherit; } /* Inherit color from container */

         .light-mode .details-container > img { /* Style for the main app poster image */
              border: 1px solid #d0d0d0;
              box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
         }

         .light-mode .detail-item {
             background-color: #e2e8f0; /* Light background for items */
         }
         .light-mode .detail-item i { color: #059669; } /* Darker green icon color */
         .light-mode .detail-item .text .label { color: #555; } /* Darker soft color */
         .light-mode .detail-item .text .value { color: #333; } /* Dark text */


         .light-mode .user-rating-container .stars { color: #f59e0b; } /* Darker yellow stars */
          .light-mode .user-rating-container .stars .filled { color: #f59e0b; }
         .light-mode .user-rating-container .stars .fa-star { color: #ccc; } /* Lighter empty star color */
         .light-mode .user-rating-container .rating-count { color: #555; }

         .light-mode #detail-download-btn { background-color: #059669; } /* Darker green */
         .light-mode #detail-download-btn:hover { background-color: #047857; }


         .light-mode .introduction-content,
         .light-mode .about-content,
         .light-mode .conclusion-content,
         .light-mode .features-list li,
         .light-mode .screenshot-gallery, /* Apply light mode style to screenshot gallery */
         .light-mode .related-posts-grid-placeholder { /* Light background for various content blocks */
             background-color: #e2e8f0;
             color: #555;
             border-color: #ccc; /* Lighter border */
         }
         .light-mode .screenshot-gallery img {
             border: 1px solid #9fa8da; /* Lighter border color */
             box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
         }
          .light-mode .screenshot-gallery .info-message {
               color: #555;
          }


         .light-mode .features-list li i { color: #d97706; } /* Darker yellow checkmark */


          .light-mode .related-post-item {
             background-color: #ffffff; /* White related item */
             color: #333;
              border: 1px solid #e0e0e0;
              box-shadow: 0 2px 5px rgba(0, 0, 0, 0.08);
          }
          .light-mode .related-post-item:hover { box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1); }
         .light-mode .related-post-item img { border: 1px solid #d0d0d0; }
         .light-mode .related-post-item .category { color: #059669; } /* Darker green */
         .light-mode .related-post-item .version-size { color: #555; }
         .light-mode .related-post-item .version-size span i { color: #059669; } /* Darker green icon */


          .light-mode .bottom-buttons .back-btn {
              background-color: #9ca3af; /* Darker gray */
              color: white;
          }
          .light-mode .bottom-buttons .back-btn:hover { background-color: #6b7280; }


         .light-mode .loading-message,
         .light-mode .error-message { color: #555; }
         .light-mode .error-message { color: #dc2626; } /* Red */
        .footer {
            padding: 30px 0;
            font-family: Arial, sans-serif;
            text-align: center;
            border-top: 1px solid #eee;
        }
        .social-icons {
            margin-bottom: 20px;
        }
        .social-icon {
            margin: 0 15px;
            display: inline-block;
        }
        .copyright {
            margin-bottom: 15px;
            color: #666;
            font-size: 14px;
        }
        .footer-links a {
            color: #555;
            text-decoration: none;
            margin: 0 12px;
            font-size: 13px;
            transition: color 0.3s;
        }
        .footer-links a:hover {
            color: #000;
        }
        .social-icon svg {
            width: 24px;
            height: 24px;
            transition: transform 0.3s;
        }
        .social-icon:hover svg {
            transform: scale(1.2);
        }



    </style>

</head>
<body class="dark-mode"> <!-- Default to dark mode. Class will be updated by JS -->

    <div class="header">
        <div class="left-section">
             <!-- Menu Icon (Hidden by CSS as no sidebar on this page) -->
             <i class="fas fa-bars icon" id="menu-toggle-icon" style="display: none;"></i>

        </div>
        <div class="right-section">
             <!-- Mode Toggle Icon (Starts as sun, implies dark mode). Updated by JS -->
             <i class="fas fa-sun icon" id="mode-toggle-icon"></i>
             <!-- Search Icon (Hidden by CSS as no search functionality on this page) -->
             <i class="fas fa-search icon" id="search-toggle-icon" style="display: none;"></i>
        </div>
    </div>

    <!-- --- Sidebar Menu --- Not included in details.html --- -->


    <!-- --- Main Content (Details View) --- -->
    <div class="details-container"> <!-- Use a class for the container -->

        <div id="loading-indicator" class="loading-message">Loading app details...</div>
        <div id="error-message" class="error-message" style="display: none;"></div>


        <div id="app-detail-content" style="display: none;">
            <!-- App Image -->
            <img id="detail-image" src="" alt="App Poster">

            <!-- App Name -->
            <h2 id="detail-name"></h2>

             <!-- App Details Grid -->
             <h3 class="details-section-title">App Details</h3>
             <div class="detail-grid">
                 <div class="detail-item">
                     <i class="fas fa-mobile-alt"></i>
                     <div class="text">
                         <span class="label">App Name</span>
                         <span class="value" id="detail-grid-name"></span>
                     </div>
                 </div>
                 <div class="detail-item">
                     <i class="fas fa-code-branch"></i>
                     <div class="text">
                         <span class="label">Latest Version</span>
                         <span class="value" id="detail-grid-version"></span>
                     </div>
                 </div>
                 <div class="detail-item">
                     <i class="fas fa-clock"></i>
                     <div class="text">
                         <span class="label">Last Updated</span>
                         <span class="value" id="detail-last-updated"></span>
                     </div>
                 </div>
                 <div class="detail-item">
                     <i class="fas fa-building"></i>
                     <div class="text">
                         <span class="label">Publisher</span>
                         <span class="value" id="detail-publisher"></span>
                     </div>
                 </div>
                 <div class="detail-item">
                     <i class="fab fa-android"></i>
                     <div class="text">
                         <span class="label">Requirements</span>
                         <span class="value" id="detail-requirements"></span>
                     </div>
                 </div>
                 <div class="detail-item">
                     <i class="fas fa-tags"></i>
                     <div class="text">
                         <span class="label">Category</span>
                         <span class="value" id="detail-category"></span>
                     </div>
                 </div>
             </div>

             <!-- Download Details Grid -->
             <h3 class="details-section-title">Download Details</h3>
             <div class="detail-grid">
                 <div class="detail-item">
                     <i class="fas fa-database"></i>
                     <div class="text">
                         <span class="label">Size</span>
                         <span class="value" id="detail-size"></span>
                     </div>
                 </div>
                  <div class="detail-item">
                      <i class="fab fa-google-play"></i>
                      <div class="text">
                          <span class="label">Source</span>
                          <span class="value">Google Playstore</span> <!-- Static text as per image -->
                      </div>
                  </div>
                 <!-- Google Play Button Placeholder -->
                 <div class="google-play-btn-container">
                      <a href="#" id="google-play-link" target="_blank" style="display: none;">
                         <img src="https://play.google.com/intl/en_us/badges/images/badge_new.png" alt="Get it on Google Play">
                      </a>
                 </div>
             </div>

             <!-- User Rating -->
             <h3 class="details-section-title">User Rating</h3>
             <div class="user-rating-container">
                 <div class="stars" id="user-rating-stars">
                     <!-- Stars will be generated by JS -->
                 </div>
                 <span class="rating-count" id="user-rating-count"></span>
             </div>


             <!-- Download Button -->
             <button id="detail-download-btn">Download (N/A)</button>


             <!-- Introduction Section -->
             <h3 class="details-section-title">Introduction</h3>
             <div class="introduction-section">
                  <div class="introduction-content" id="introduction-content">
                      <!-- Introduction text will be loaded by JS -->
                      <p class="info-message">No introduction available.</p> <!-- Default message -->
                  </div>
              </div>


             <!-- MOD Features -->
             <h3 class="details-section-title">MOD Features</h3>
             <div class="features-section">
                  <ul class="features-list" id="mod-features-list">
                      <!-- Features will be loaded by JS -->
                      <p class="info-message">No MOD features listed.</p> <!-- Default message if no features -->
                  </ul>
             </div>

             <!-- About This MOD -->
             <h3 class="details-section-title">About This MOD</h3>
              <div class="about-section">
                  <div class="about-content" id="about-mod-content">
                      <!-- About text will be loaded by JS -->
                      <p class="info-message">No description available.</p> <!-- Default message -->
                  </div>
              </div>

             <!-- Recent Captures Section -->
             <h3 class="details-section-title">Recent Captures</h3>
             <div class="screenshot-gallery" id="screenshot-gallery">
                  <!-- Screenshots will be loaded by JS -->
                  <p class="info-message">Loading screenshots...</p> <!-- Initial loading message -->
             </div>


             <!-- Conclusion Section -->
             <h3 class="details-section-title">Conclusion</h3>
             <div class="conclusion-section">
                  <div class="conclusion-content" id="conclusion-content">
                      <!-- Conclusion text will be loaded by JS -->
                      <p class="info-message">No conclusion available.</p> <!-- Default message -->
                  </div>
              </div>

             <!-- Related Posts Section -->
             <h3 class="details-section-title">Related Posts</h3>
             <div class="related-posts-section"> <!-- Using the existing section class -->
                   <div class="related-posts-grid-placeholder"> <!-- Placeholder for initial state -->
                       <p>Loading related posts...</p>
                   </div>
                   <!-- The actual related-posts-grid div will be inserted here by JS -->
              </div>


             <!-- Back Button -->
             <div class="bottom-buttons">
                 <button id="back-to-list-btn" class="back-btn">Back to List</button>
             </div>

        </div>

    </div>

    <!-- --- Modal Gallery Structure --- -->
     <div id="gallery-modal">
         <span class="fas fa-times" id="modal-close-btn"></span>
         <div id="modal-content">
             <i class="fas fa-chevron-left modal-nav-btn" id="prev-screenshot-btn"></i>
             <img id="modal-image" src="" alt="App Screenshot">
             <i class="fas fa-chevron-right modal-nav-btn" id="next-screenshot-btn"></i>
         </div>
          <div id="image-counter"></div>
     </div>


    <!-- --- Footer --- -->
<footer class="footer">
    <div class="social-icons">
        <a href="https://www.instagram.com/apkz.one?igsh=YzBuaGVzaDRub3Ux" class="social-icon">
            <svg viewBox="0 0 24 24" style="fill:#e1306c">
                <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
            </svg>
        </a>
        <a href="https://youtube.com/@fullh.dmovie?si=edWEDi8PCx-Zj_sv" class="social-icon">
            <svg viewBox="0 0 24 24" style="fill:#ff0000">
                <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/>
            </svg>
        </a>
        <a href="https://t.me/+mu8H74OWEV43OTNl" class="social-icon">
            <svg viewBox="0 0 24 24" style="fill:#0088cc">
                <path d="M9.417 15.181l-.397 5.584c.568 0 .814-.244 1.109-.537l2.663-2.545 5.518 4.041c1.012.564 1.725.267 1.998-.931l3.622-16.972.001-.001c.321-1.496-.541-2.081-1.527-1.714l-21.29 8.151c-1.453.564-1.431 1.374-.247 1.741l5.443 1.693 12.643-7.911c.595-.394 1.136-.176.691.218z"/>
            </svg>
        </a>
    </div>
    <div class="copyright">
        © 2025 YourCompany. All Rights Reserved.
    </div>
    <div class="footer-links">
        <a href="Privacy.html">Privacy Policy</a>
        <a href="About Us.html">About Us</a>
        <a href="Contact.html">Contact Us</a>
        <a href="Term.html">Terms of Service</a>
    </div>
</footer>


    <!-- Load Firebase config and services -->
    <script type="module">
       // Firebase SDKs को import karein
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js';
    import { getFirestore, doc, getDoc } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js';

    // आपकी Google Firebase project configuration (Embedded here)
    const firebaseConfig = {
      apiKey: "AIzaSyDXyZojvzlB7XQXOFw6n_kWK07mvtzVzYY",
      authDomain: "apps-1945d.firebaseapp.com",
      projectId: "apps-1945d",
      storageBucket: "apps-1945d.firebasestorage.app",
      messagingSenderId: "922330585425",
      appId: "1:922330585425:web:455c102287f072a78f1b70"
      // measurementId: "YOUR_MEASUREMENT_ID" // <-- Uncomment and replace if using Analytics
    };

    // Firebase को initialize करें
    const app = initializeApp(firebaseConfig);

    // Firestore service का instance प्राप्त करें
    const db = getFirestore(app);


    // --- Global variables for gallery state ---
    let allScreenshotUrls = []; // Array to hold all screenshot URLs for the current app
    let currentScreenshotIndex = -1; // Index of the currently displayed screenshot in the modal


    // --- DOM Elements ---
    const body = document.body; // Reference to the body for mode toggle
    const loadingIndicator = document.getElementById('loading-indicator');
    const errorMessageDiv = document.getElementById('error-message');
    const appDetailContentDiv = document.getElementById('app-detail-content'); // The main div containing all details

    const detailsPageTitle = document.getElementById('details-page-title'); // To update page title

    // App Details
    const detailImage = document.getElementById('detail-image');
    const detailName = document.getElementById('detail-name'); // This is the h2 name below the image
    const detailGridName = document.getElementById('detail-grid-name'); // Name in the "App Details" grid
    const detailGridVersion = document.getElementById('detail-grid-version'); // Version in the grid
    const detailLastUpdated = document.getElementById('detail-last-updated');
    const detailPublisher = document.getElementById('detail-publisher');
    const detailRequirements = document.getElementById('detail-requirements');
    const detailCategory = document.getElementById('detail-category'); // Category in the grid

    // Download Details
    const detailSize = document.getElementById('detail-size'); // Size in the grid
    const googlePlayLink = document.getElementById('google-play-link'); // Google Play button link

    // User Rating
    const userRatingStarsDiv = document.getElementById('user-rating-stars');
    const userRatingCountSpan = document.getElementById('user-rating-count');

    // Download Button
    const detailDownloadBtn = document.getElementById('detail-download-btn');

    // Introduction / Conclusion / About Section Content DIVs
    const introductionContentDiv = document.getElementById('introduction-content');
    const modFeaturesList = document.getElementById('mod-features-list');
    const aboutModContentDiv = document.getElementById('about-mod-content');
    const conclusionContentDiv = document.getElementById('conclusion-content');

    // Screenshot Gallery Element
    const screenshotGalleryDiv = document.getElementById('screenshot-gallery');

    // Modal Gallery Elements
    const galleryModal = document.getElementById('gallery-modal');
    const modalImage = document.getElementById('modal-image');
    const prevScreenshotBtn = document.getElementById('prev-screenshot-btn');
    const nextScreenshotBtn = document.getElementById('next-screenshot-btn');
    const modalCloseBtn = document.getElementById('modal-close-btn');
    const imageCounter = document.getElementById('image-counter');


    // Related Posts Elements
    const relatedPostsSection = document.querySelector('.related-posts-section'); // The section div
    const relatedPostsGridDiv = document.createElement('div'); // Create a new div for the actual grid
    relatedPostsGridDiv.classList.add('related-posts-grid'); // Add the grid class for styling
    const relatedPostsPlaceholder = document.querySelector('.related-posts-grid-placeholder'); // The placeholder div


    // Buttons
    const backToListBtn = document.getElementById('back-to-list-btn');


    // Mode Toggle Element (Header Icons)
    const modeToggleIcon = document.getElementById('mode-toggle-icon');
    // Search toggle icon is hidden by CSS on this page


    // --- Helper Functions ---

    // Function to show a specific content area and hide others
    function showContent(contentId) {
         loadingIndicator.style.display = 'none';
         errorMessageDiv.style.display = 'none';
         appDetailContentDiv.style.display = 'none';

         if (contentId === 'detail') {
             appDetailContentDiv.style.display = 'flex'; // Use flex for detail content container
         } else if (contentId === 'loading') {
             loadingIndicator.style.display = 'block';
         } else if (contentId === 'error') {
             errorMessageDiv.style.display = 'block';
         }
         // Scroll to the top of the container when content changes
         const container = document.querySelector('.details-container'); // Use the class name
          if(container) {
              container.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
    }

     // Function to render star rating
     function renderStars(rating, ratingCount) {
         userRatingStarsDiv.innerHTML = ''; // Clear existing stars
         // Ensure rating is a number between 0 and 5
         const validRating = Math.max(0, Math.min(5, parseFloat(rating) || 0));

         const fullStars = Math.floor(validRating);
         // Check for half star only if rating has a decimal part and is within the range
         const halfStar = validRating % 1 !== 0 && validRating > 0 && validRating < 5.0; // Corrected halfStar logic


         for (let i = 0; i < 5; i++) {
             const starIcon = document.createElement('i');
             starIcon.classList.add('fas'); // Font Awesome Solid

             if (i < fullStars) {
                 starIcon.classList.add('fa-star', 'filled'); // Full filled star
             } else if (i === fullStars && halfStar) {
                 // Use fa-star-half-alt for Font Awesome 5/6
                 starIcon.classList.add('fa-star-half-alt', 'filled'); // Half filled star
             } else {
                 starIcon.classList.add('fa-star'); // Empty star
             }
             userRatingStarsDiv.appendChild(starIcon);
         }

         userRatingCountSpan.textContent = `(${ratingCount || 0} ratings)`;
     }

     // Function to render a single related app item (similar to index.html item)
     function renderRelatedAppItem(app) {
         const appItem = document.createElement('div');
         appItem.classList.add('related-post-item'); // Use the specific class for related items

         // Build the inner HTML (similar to index.html app-item structure)
          let badgesHtml = '';
          // Example badges based on category or other data
           if ((app.category || '').toLowerCase() === 'games') { badgesHtml += `<span class="badge mod">MOD</span>`; } // Example MOD badge for Games category
           // if (true) { badgesHtml += `<span class="badge new">NEW</span>; } // Example: Always show NEW for related items? Or remove this.


          // Badges are not typically shown inside related posts in this design, commented out the badge container
          /*
          if (badgesHtml) { badgesHtml = `<div class="badges" style="position: static; display: block; text-align: right; margin-bottom: 5px;">${badgesHtml}</div>`; } // Adjust badge positioning for related item
          */


         appItem.innerHTML = `
             <div style="position: relative;"> <!-- Wrapper for badges (even if no badges) -->
                 <img src="${app.imageUrl || 'placeholder.png'}" alt="${app.name || 'App Image'}">
                 <!-- Badges can be added here if needed -->
             </div>
             <div class="item-details">
                 <h3>${app.name || 'Untitled App'}</h3>
                 <div class="category">${app.category || 'App'}</div>
                 <div class="version-size">
                     <span><i class="fas fa-bolt"></i> ${app.version || 'N/A'}</span>
                     <span><i class="fas fa-download"></i> ${app.size || 'N/A'}</span>
                 </div>
             </div>
         `;

         // Add click listener to navigate to the related app's details page
         appItem.addEventListener('click', () => {
             if (app.id) {
                 // Navigate to the related app's details page, reloading the page
                 window.location.href = `details.html?id=${app.id}`;
                 // Optional: Add a loading indicator here if navigation takes time
             }
         });

         return appItem; // Return the created DOM element
     }


     // Function to fetch and render related apps
     async function fetchAndRenderRelatedApps(relatedIds) {
         relatedPostsGridDiv.innerHTML = ''; // Clear previous related items
         // Hide placeholder and append the actual grid div if not already done
         if (relatedPostsPlaceholder && relatedPostsPlaceholder.parentNode) {
             relatedPostsPlaceholder.parentNode.insertBefore(relatedPostsGridDiv, relatedPostsPlaceholder);
             relatedPostsPlaceholder.style.display = 'none';
         } else if (!relatedPostsSection.contains(relatedPostsGridDiv)) {
             relatedPostsSection.appendChild(relatedPostsGridDiv); // Add the grid if section exists but no placeholder found
         }


         if (!relatedIds || relatedIds.length === 0) {
             relatedPostsGridDiv.innerHTML = '<p class="info-message" style="text-align: center;">No related apps listed.</p>';
             relatedPostsGridDiv.style.display = 'block'; // Show as block for the message
             return;
         }

         try {
             // Fetch all related app documents concurrently
             const relatedAppPromises = relatedIds.map(id => {
                 if (typeof id === 'string' && id.trim() !== '') { // Basic ID validation
                     return getDoc(doc(db, 'apps', id.trim()));
                 }
                 return Promise.resolve(null); // Return null for invalid IDs
             });

             const relatedAppSnaps = await Promise.all(relatedAppPromises);

             const relatedApps = relatedAppSnaps
                 .filter(snap => snap && snap.exists()) // Filter out nulls and non-existent docs
                 .map(snap => ({ id: snap.id, ...snap.data() })); // Map snapshots to data objects

             if (relatedApps.length === 0) {
                 relatedPostsGridDiv.innerHTML = '<p class="info-message" style="text-align: center;">Could not find any related apps for the given IDs.</p>';
                 relatedPostsGridDiv.style.display = 'block'; // Show as block for the message
                 return;
             }

             // Render the fetched related apps
             relatedApps.forEach(app => {
                 const appItemElement = renderRelatedAppItem(app); // Create the UI element
                 relatedPostsGridDiv.appendChild(appItemElement); // Add to the grid container
             });

             relatedPostsGridDiv.style.display = 'grid'; // Show as grid

         } catch (error) {
             console.error("Error fetching related apps: ", error);
             relatedPostsGridDiv.innerHTML = `<p class="error-message" style="text-align: center;">Error loading related apps: ${error.message}</p>`;
             relatedPostsGridDiv.style.display = 'block'; // Show as block for the message
         }
     }


    // --- Mode Toggle Functionality ---
    function toggleDarkMode() {
        const isLightMode = body.classList.contains('light-mode');
        if (isLightMode) {
            // Switch to Dark Mode
            body.classList.remove('light-mode');
            body.classList.add('dark-mode');
            modeToggleIcon.classList.remove('fa-moon'); // Change icon to sun
            modeToggleIcon.classList.add('fa-sun');
            localStorage.setItem('mode', 'dark'); // Save preference
        } else {
            // Switch to Light Mode
            body.classList.remove('dark-mode');
            body.classList.add('light-mode');
            modeToggleIcon.classList.remove('fa-sun'); // Change icon to moon
            modeToggleIcon.classList.add('fa-moon');
            localStorage.setItem('mode', 'light'); // Save preference
        }
    }

     // Apply saved mode on page load
     function applySavedMode() {
         const savedMode = localStorage.getItem('mode');
         if (savedMode === 'light') {
             body.classList.remove('dark-mode');
             body.classList.add('light-mode');
             modeToggleIcon.classList.remove('fa-sun');
             modeToggleIcon.classList.add('fa-moon');
         } else {
             // Default to dark mode if no preference saved or saved is 'dark'
             body.classList.remove('light-mode');
             body.classList.add('dark-mode');
             modeToggleIcon.classList.remove('fa-moon');
             modeToggleIcon.classList.add('fa-sun');
         }
     }

     // --- Modal Gallery Functions ---

     // Function to open the modal and display a specific screenshot
     function openScreenshotModal(index) {
         // Ensure allScreenshotUrls is correctly populated BEFORE calling this function
         if (!allScreenshotUrls || !Array.isArray(allScreenshotUrls) || allScreenshotUrls.length === 0 || index < 0 || index >= allScreenshotUrls.length) {
             console.warn("Invalid index or no screenshots available for modal.");
             return; // Do nothing if index is invalid or no screenshots
         }

         currentScreenshotIndex = index;
         modalImage.src = allScreenshotUrls[currentScreenshotIndex];
         updateModalContent(); // Update image, counter, and buttons
         galleryModal.style.display = 'flex'; // Show the modal
         body.style.overflow = 'hidden'; // Prevent scrolling the body when modal is open
     }

     // Function to close the modal
     function closeScreenshotModal() {
         galleryModal.style.display = 'none'; // Hide the modal
         body.style.overflow = ''; // Restore body scrolling
     }

     // Function to display the next screenshot
     function showNextScreenshot() {
         if (currentScreenshotIndex < allScreenshotUrls.length - 1) {
             currentScreenshotIndex++;
             modalImage.src = allScreenshotUrls[currentScreenshotIndex];
             updateModalContent();
         }
     }

     // Function to display the previous screenshot
     function showPreviousScreenshot() {
         if (currentScreenshotIndex > 0) {
             currentScreenshotIndex--;
             modalImage.src = allScreenshotUrls[currentScreenshotIndex];
             updateModalContent();
         }
     }

     // Function to update modal content (image, counter, buttons)
     function updateModalContent() {
         modalImage.src = allScreenshotUrls[currentScreenshotIndex];
         imageCounter.textContent = `Image ${currentScreenshotIndex + 1} of ${allScreenshotUrls.length}`;

         // Hide/Show navigation buttons
         prevScreenshotBtn.style.display = (currentScreenshotIndex === 0) ? 'none' : 'block';
         nextScreenshotBtn.style.display = (currentScreenshotIndex === allScreenshotUrls.length - 1) ? 'none' : 'block';
     }


    // --- Function to fetch and display single app detail ---
    async function fetchAndDisplayAppDetail(appId) {
        showContent('loading'); // Show loading indicator

        try {
            const appDocRef = doc(db, 'apps', appId);
            const appSnap = await getDoc(appDocRef);

            if (appSnap.exists()) {
                const appData = appSnap.data();

                // Populate DOM elements with app data
                detailsPageTitle.textContent = appData.name || 'App Details'; // Update page title
                detailImage.src = appData.imageUrl || 'placeholder.png';
                detailImage.alt = appData.name || 'App Image';
                detailName.textContent = appData.name || 'Untitled App'; // Main H2 name below the image
                detailGridName.textContent = appData.name || 'N/A'; // Name in the "App Details" grid
                detailGridVersion.textContent = appData.version || 'N/A';
                detailLastUpdated.textContent = appData.lastUpdated || 'N/A';
                detailPublisher.textContent = appData.publisher || 'N/A';
                detailRequirements.textContent = appData.requirements || 'N/A';
                detailCategory.textContent = appData.category || 'App'; // Category in the grid
                detailSize.textContent = appData.size || 'N/A'; // Size in grid


                // Handle Google Play link (Optional field)
                if (appData.playStoreUrl && appData.playStoreUrl.trim() !== '') {
                     googlePlayLink.href = appData.playStoreUrl;
                     googlePlayLink.style.display = 'inline-block'; // Show the link
                 } else {
                     googlePlayLink.style.display = 'none'; // Hide if no URL
                 }


                // Handle User Rating
                const userRating = parseFloat(appData.userRating) || 0; // Convert to number
                const ratingCount = parseInt(appData.ratingCount) || 0; // Convert to integer
                renderStars(userRating, ratingCount);


                // Set text for Download button
                detailDownloadBtn.textContent = `Download (${appData.size || 'N/A'})`;


                // Handle Download button URL
                const downloadUrl = appData.downloadUrl;
                if (downloadUrl && downloadUrl.trim() !== '' && downloadUrl.trim().toLowerCase() !== 'n/a') {
                    detailDownloadBtn.style.display = 'inline-block';
                     // Remove previous listener and add a new one to prevent duplicates
                     const newDownloadBtn = detailDownloadBtn.cloneNode(true);
                     detailDownloadBtn.parentNode.replaceChild(newDownloadBtn, detailDownloadBtn);
                     // Get the reference to the new button after replacement
                     const finalDownloadBtn = document.getElementById('detail-download-btn');

                    finalDownloadBtn.addEventListener('click', () => {
                        window.open(downloadUrl, '_blank'); // Open download URL in a new tab
                    });
                } else {
                    detailDownloadBtn.style.display = 'none'; // Hide button if no valid URL
                }


                // Handle Introduction (Requires introductionText field)
                 introductionContentDiv.innerHTML = ''; // Clear default message
                 if (appData.introductionText && appData.introductionText.trim() !== '') {
                     introductionContentDiv.innerHTML = `<p>${appData.introductionText.trim()}</p>`;
                 } else {
                      introductionContentDiv.innerHTML = '<p class="info-message">No introduction available.</p>';
                 }


                // Handle MOD Features (Requires modFeatures as an array of strings)
                const modFeatures = appData.modFeatures;
                modFeaturesList.innerHTML = ''; // Clear default message/previous features
                if (modFeatures && Array.isArray(modFeatures) && modFeatures.length > 0) {
                     modFeatures.forEach(feature => {
                         const li = document.createElement('li');
                         li.innerHTML = `<i class="fas fa-check-circle"></i> ${feature}`; // Checkmark icon
                         modFeaturesList.appendChild(li);
                     });
                } else {
                     modFeaturesList.innerHTML = '<p class="info-message">No MOD features listed.</p>'; // Show default message
                }

                 // --- Handle Screenshots & Prepare for Gallery ---
                 const screenshotUrls = appData.screenshotUrls;
                 allScreenshotUrls = []; // Clear global array for modal
                 screenshotGalleryDiv.innerHTML = ''; // Clear initial loading message or previous images

                 // Ensure screenshotUrls is a valid array before proceeding
                 if (screenshotUrls && Array.isArray(screenshotUrls) && screenshotUrls.length > 0) {
                      // Filter out any non-string or empty/whitespace URLs
                      allScreenshotUrls = screenshotUrls.filter(url => typeof url === 'string' && url.trim() !== '');

                      if (allScreenshotUrls.length > 0) {
                          allScreenshotUrls.forEach((url, index) => { // Use index in foreach
                               // Create thumbnail image
                               const img = document.createElement('img');
                               img.src = url; // Set the source from the valid URL
                               img.alt = `${appData.name || 'App'} Screenshot ${index + 1}`; // Descriptive alt text
                               img.classList.add('screenshot-item'); // Add class for styling
                               // Add a click listener to each thumbnail to open the modal
                               img.addEventListener('click', () => {
                                    // Open the modal with the clicked image's index
                                    openScreenshotModal(index);
                               });
                               screenshotGalleryDiv.appendChild(img); // Append thumbnail to the gallery div
                          });
                      } else {
                           // Case: screenshotUrls was an array, but contained only invalid items
                           screenshotGalleryDiv.innerHTML = '<p class="info-message">No valid screenshots found after processing URLs.</p>';
                      }
                 } else {
                      // Case: screenshotUrls field is missing, not an array, or is an empty array
                      screenshotGalleryDiv.innerHTML = '<p class="info-message">No screenshots available.</p>'; // Show default message
                 }


                  // Handle Conclusion (Requires conclusionText field)
                  const conclusionText = appData.conclusionText;
                  conclusionContentDiv.innerHTML = ''; // Clear default message
                   if (conclusionText && conclusionText.trim() !== '') {
                       conclusionContentDiv.innerHTML = `<p>${conclusionText.trim()}</p>`;
                   } else {
                        conclusionContentDiv.innerHTML = '<p class="info-message">No conclusion available.</p>';
                   }


                 // --- Handle Related Posts ---
                 const relatedAppIds = appData.relatedAppIds;
                 fetchAndRenderRelatedApps(relatedAppIds); // Call the function to fetch and display related apps


                showContent('detail'); // Show the populated detail content

            } else {
                // App with the given ID not found
                errorMessageDiv.textContent = 'App details not found for this ID.';
                showContent('error');
            }

        } catch (error) {
            console.error("Error fetching app detail: ", error);
            errorMessageDiv.textContent = `Error loading app details: ${error.message}. Check Firebase Config and Rules.`;
            showContent('error');
        }
    }


    // --- Event Listeners ---

    // Event listener for the Download button on the details page is added inside fetchAndDisplayAppDetail


    // Event listener for the Back to List button
    backToListBtn.addEventListener('click', () => {
        window.location.href = 'index.html'; // Navigate back to the user list page (assuming index.html is the main list page)
    });

    // Event listener for the Mode toggle icon (Sun/Moon)
    modeToggleIcon.addEventListener('click', toggleDarkMode);

    // --- Modal Gallery Event Listeners ---
     modalCloseBtn.addEventListener('click', closeScreenshotModal);
     prevScreenshotBtn.addEventListener('click', showPreviousScreenshot);
     nextScreenshotBtn.addEventListener('click', showNextScreenshot);

     // Close modal when clicking outside the image/buttons
     galleryModal.addEventListener('click', (event) => {
         // Check if the click occurred directly on the modal background (not the image or buttons inside modal-content)
         if (event.target === galleryModal) {
             closeScreenshotModal();
         }
     });

     // Close modal on Escape key press
     document.addEventListener('keydown', (event) => {
         if (event.key === 'Escape' && galleryModal.style.display === 'flex') {
             closeScreenshotModal();
         }
          // Optional: Add keyboard navigation for next/previous using arrow keys
          if (galleryModal.style.display === 'flex') { // Only navigate if modal is open
              if (event.key === 'ArrowRight') {
                  showNextScreenshot();
              } else if (event.key === 'ArrowLeft') {
                  showPreviousScreenshot();
              }
          }
     });

     // Optional: Add swipe functionality (more complex, requires touch event handling)
     // For simplicity, we'll stick to buttons and keys for now.


    // --- Initial Load ---
    applySavedMode(); // Apply theme first

    // Get the app ID from the URL query string
    const urlParams = new URLSearchParams(window.location.search);
    const appId = urlParams.get('id'); // Get the 'id' parameter

    if (appId) {
        // If an ID is found in the URL, fetch and display the app detail
        fetchAndDisplayAppDetail(appId);
    } else {
        // If no ID is found in the URL, show an error message
        errorMessageDiv.textContent = 'No app ID specified in the URL to load details.';
        showContent('error');
    }
    </script>

</body>
</html>
