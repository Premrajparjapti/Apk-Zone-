<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="details-page-title">Loading Details...</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- Base Styles (Dark Mode Default) --- */
        :root {
            --primary: #6c5ce7;
            --primary-dark: #5649c0;
            --primary-light: rgba(108, 92, 231, 0.1);
            --secondary: #00cec9;
            --secondary-dark: #00a8a4;
            --secondary-light: rgba(0, 206, 201, 0.1);
            --accent: #fd79a8;
            --success: #00b894;
            --warning: #fdcb6e;
            --danger: #d63031;
            --dark-bg: #121212;
            --dark-card: #1e1e1e;
            --dark-header: #0f0f0f;
            --dark-text: #ffffff;
            --dark-text-secondary: #b0b0b0;
            --light-bg: #f8f9fa;
            --light-card: #ffffff;
            --light-header: #ffffff;
            --light-text: #2d3436;
            --light-text-secondary: #636e72;
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.1), 0 6px 6px rgba(0, 0, 0, 0.08);
            --shadow-xl: 0 15px 25px rgba(0, 0, 0, 0.15), 0 5px 10px rgba(0, 0, 0, 0.05);
            --border-radius: 12px;
            --border-radius-sm: 8px;
            --border-radius-lg: 16px;
            --border-radius-xl: 24px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            background-color: var(--dark-bg);
            color: var(--dark-text);
            padding-top: 70px;
            padding-bottom: 20px;
            overflow-x: hidden;
            transition: var(--transition);
            line-height: 1.6;
        }

        /* Smooth scroll behavior */
        html {
            scroll-behavior: smooth;
        }

        /* --- Header Styles --- */
        .header {
            background-color: var(--dark-header);
            padding: 12px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow-xl);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            transition: var(--transition);
            backdrop-filter: blur(10px);
            background-color: rgba(15, 15, 15, 0.8);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .header .left-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--primary);
            text-decoration: none;
            transition: var(--transition);
        }

        .header .logo i {
            font-size: 1.6rem;
            color: var(--primary);
        }

        .header .logo:hover {
            color: var(--primary-dark);
            transform: translateY(-2px);
        }

        .header .right-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header .icon {
            font-size: 1.4rem;
            color: var(--dark-text-secondary);
            cursor: pointer;
            transition: var(--transition);
            padding: 5px;
            border-radius: 50%;
        }

        .header .icon:hover {
            color: var(--dark-text);
            background-color: var(--primary-light);
            transform: scale(1.1);
        }

        /* --- Main Content Container --- */
        .container {
            max-width: 1200px;
            margin: auto;
            padding: 0 20px;
        }

        /* Loading and Error States */
        .loading-message, .error-message {
            text-align: center;
            padding: 40px 20px;
            font-size: 1.1rem;
            margin: 40px 0;
            border-radius: var(--border-radius);
            background-color: rgba(255, 255, 255, 0.05);
        }

        .loading-message {
            color: var(--dark-text-secondary);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
        }

        .loading-message i {
            font-size: 2rem;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            color: var(--danger);
            display: none;
            background-color: rgba(214, 48, 49, 0.1);
        }

        /* App Detail Content */
        #app-detail-content {
            display: none;
            flex-direction: column;
            gap: 30px;
        }

        /* App Header Section */
        .app-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            text-align: center;
            width: 100%;
            padding: 30px 0;
            position: relative;
            overflow: hidden;
            border-radius: var(--border-radius-lg);
            margin-bottom: 20px;
        }

        .app-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            opacity: 0.1;
            z-index: -1;
        }

        #detail-image {
            width: 180px;
            height: 180px;
            object-fit: cover;
            border-radius: var(--border-radius-lg);
            border: 3px solid var(--primary);
            box-shadow: var(--shadow-xl);
            transition: var(--transition);
            background-color: var(--dark-card);
        }

        #detail-image:hover {
            transform: scale(1.03) rotate(2deg);
            box-shadow: 0 10px 30px rgba(108, 92, 231, 0.3);
        }

        #detail-name {
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark-text);
            margin: 0;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            padding: 0 10px;
        }

        /* Floating animation for app icon */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        .floating {
            animation: float 3s ease-in-out infinite;
        }

        /* Section Titles */
        .details-section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--dark-text);
            margin-top: 40px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            padding-bottom: 10px;
        }

        .details-section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 3px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            border-radius: 3px;
        }

        .details-section-title i {
            color: var(--primary);
            background-color: var(--primary-light);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        /* Detail Grid */
        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            width: 100%;
        }

        .detail-item {
            background-color: var(--dark-card);
            padding: 20px;
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            gap: 15px;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
        }

        .detail-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary), var(--secondary));
        }

        .detail-item:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary);
        }

        .detail-item i {
            font-size: 1.5rem;
            color: var(--primary);
            min-width: 24px;
        }

        .detail-item .text {
            flex: 1;
        }

        .detail-item .label {
            font-size: 0.85rem;
            color: var(--dark-text-secondary);
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .detail-item .value {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark-text);
        }

        /* User Rating */
        .user-rating-container {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
            padding: 20px;
            background-color: var(--dark-card);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
        }

        .stars {
            font-size: 1.8rem;
            color: var(--warning);
            display: flex;
            gap: 5px;
        }

        .stars .fa-star {
            color: var(--dark-text-secondary);
        }

        .stars .filled {
            color: var(--warning);
        }

        .rating-count {
            font-size: 1rem;
            color: var(--dark-text-secondary);
        }

        /* Download Button */
        #detail-download-btn {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            margin: 20px 0;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 10px;
            box-shadow: var(--shadow-md);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        #detail-download-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, var(--primary-dark), var(--secondary-dark));
            z-index: -1;
            opacity: 0;
            transition: var(--transition);
        }

        #detail-download-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        #detail-download-btn:hover::before {
            opacity: 1;
        }

        #detail-download-btn i {
            font-size: 1.1em;
        }

        /* Google Play Button */
        .google-play-btn-container {
            width: 100%;
            text-align: center;
            margin: 20px 0;
        }

        .google-play-btn {
            display: inline-block;
            height: 60px;
            transition: var(--transition);
            border-radius: var(--border-radius-sm);
            overflow: hidden;
        }

        .google-play-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }

        /* Content Sections */
        .content-section {
            width: 100%;
            background-color: var(--dark-card);
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
        }

        .content-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(108, 92, 231, 0.05), rgba(0, 206, 201, 0.05));
            opacity: 0;
            transition: var(--transition);
            z-index: -1;
        }

        .content-section:hover {
            box-shadow: var(--shadow-md);
            border-color: var(--primary);
        }

        .content-section:hover::before {
            opacity: 1;
        }

        .content-section p {
            margin-bottom: 15px;
            font-size: 1rem;
            line-height: 1.7;
        }

        .content-section p:last-child {
            margin-bottom: 0;
        }

        .info-message {
            color: var(--dark-text-secondary);
            font-style: italic;
            text-align: center;
            padding: 15px;
        }

        /* Features List */
        .features-list {
            list-style: none;
            padding: 0;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .features-list li {
            background-color: var(--secondary-light);
            padding: 15px 20px;
            border-radius: var(--border-radius-sm);
            display: flex;
            align-items: flex-start;
            gap: 12px;
            transition: var(--transition);
            border-left: 3px solid var(--secondary);
        }

        .features-list li:hover {
            transform: translateX(5px);
            background-color: rgba(0, 206, 201, 0.2);
        }

        .features-list li i {
            color: var(--secondary);
            font-size: 1.2rem;
            margin-top: 2px;
        }

        /* Screenshot Gallery */
        .screenshot-gallery {
            width: 100%;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .screenshot-gallery img {
            width: 100%;
            height: 350px;
            object-fit: cover;
            border-radius: var(--border-radius);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow-sm);
            cursor: pointer;
            transition: var(--transition);
        }

        .screenshot-gallery img:hover {
            transform: scale(1.02);
            box-shadow: var(--shadow-md);
            border-color: var(--primary);
        }

        /* Related Posts */
        .related-posts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .related-post-item {
            background-color: var(--dark-card);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
        }

        .related-post-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, transparent 60%, rgba(0, 0, 0, 0.7));
            z-index: 1;
        }

        .related-post-item:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary);
        }

        .related-post-item img {
            width: 100%;
            height: 160px;
            object-fit: cover;
            transition: var(--transition);
        }

        .related-post-item:hover img {
            transform: scale(1.05);
        }

        .related-post-item .item-details {
            padding: 15px;
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 2;
        }

        .related-post-item h3 {
            font-size: 1rem;
            margin: 0 0 8px 0;
            color: var(--dark-text);
            font-weight: 600;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .related-post-item .category {
            font-size: 0.85rem;
            color: var(--secondary);
            margin-bottom: 10px;
            font-weight: 500;
        }

        .related-post-item .version-size {
            font-size: 0.85rem;
            color: var(--dark-text-secondary);
            display: flex;
            justify-content: space-between;
            margin-top: auto;
        }

        .related-post-item .version-size i {
            margin-right: 5px;
            color: var(--secondary);
        }

        /* Bottom Buttons */
        .bottom-buttons {
            width: 100%;
            display: flex;
            justify-content: center;
            margin-top: 50px;
        }

        .back-btn {
            background-color: var(--dark-card);
            color: var(--dark-text);
            padding: 12px 30px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: var(--shadow-sm);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .back-btn:hover {
            background-color: var(--primary);
            color: white;
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary);
        }

        /* Modal Gallery */
        #gallery-modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        #modal-content {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            max-width: 90%;
            max-height: 90%;
        }

        #modal-image {
            max-width: 90vw;
            max-height: 90vh;
            object-fit: contain;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        }

        .modal-nav-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 2.5rem;
            color: white;
            cursor: pointer;
            padding: 15px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 50%;
            transition: var(--transition);
            opacity: 0.7;
        }

        .modal-nav-btn:hover {
            opacity: 1;
            background-color: rgba(0, 0, 0, 0.5);
        }

        #prev-screenshot-btn {
            left: 20px;
        }

        #next-screenshot-btn {
            right: 20px;
        }

        #modal-close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 2rem;
            color: white;
            cursor: pointer;
            transition: var(--transition);
            opacity: 0.7;
        }

        #modal-close-btn:hover {
            opacity: 1;
            transform: rotate(90deg);
        }

        #image-counter {
            color: white;
            font-size: 1.1rem;
            margin-top: 20px;
            opacity: 0.8;
        }

        /* Footer */
        .footer {
            padding: 50px 0 30px;
            font-family: 'Poppins', sans-serif;
            text-align: center;
            margin-top: 60px;
            background-color: var(--dark-header);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(108, 92, 231, 0.05), rgba(0, 206, 201, 0.05));
            z-index: -1;
        }

        .social-icons {
            margin-bottom: 25px;
            display: flex;
            justify-content: center;
            gap: 25px;
        }

        .social-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(255, 255, 255, 0.1);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .social-icon::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: var(--transition);
            z-index: -1;
        }

        .social-icon:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: var(--shadow-md);
        }

        .social-icon:hover::before {
            opacity: 1;
        }

        .social-icon svg {
            width: 22px;
            height: 22px;
            transition: var(--transition);
        }

        .social-icon:hover svg {
            fill: white;
        }

        .copyright {
            margin-bottom: 20px;
            color: var(--dark-text-secondary);
            font-size: 0.9rem;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }

        .footer-links a {
            color: var(--dark-text-secondary);
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 500;
            transition: var(--transition);
            padding: 5px 10px;
            border-radius: var(--border-radius-sm);
        }

        .footer-links a:hover {
            color: var(--dark-text);
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* --- Light Mode Styles --- */
        body.light-mode {
            background-color: var(--light-bg);
            color: var(--light-text);
        }

        .light-mode .header {
            background-color: var(--light-header);
            color: var(--light-text);
            box-shadow: var(--shadow-sm);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            background-color: rgba(255, 255, 255, 0.8);
        }

        .light-mode .header .icon {
            color: var(--light-text-secondary);
        }

        .light-mode .header .icon:hover {
            color: var(--light-text);
            background-color: rgba(0, 0, 0, 0.05);
        }

        .light-mode .loading-message,
        .light-mode .info-message {
            color: var(--light-text-secondary);
            background-color: rgba(0, 0, 0, 0.03);
        }

        .light-mode .error-message {
            color: var(--danger);
            background-color: rgba(214, 48, 49, 0.1);
        }

        .light-mode #detail-name {
            color: var(--light-text);
        }

        .light-mode .details-section-title {
            color: var(--light-text);
        }

        .light-mode .detail-item {
            background-color: var(--light-card);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .light-mode .detail-item:hover {
            border-color: var(--primary);
        }

        .light-mode .detail-item .label {
            color: var(--light-text-secondary);
        }

        .light-mode .detail-item .value {
            color: var(--light-text);
        }

        .light-mode .user-rating-container {
            background-color: var(--light-card);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .light-mode .user-rating-container .rating-count {
            color: var(--light-text-secondary);
        }

        .light-mode .content-section,
        .light-mode .features-list li,
        .light-mode .related-post-item {
            background-color: var(--light-card);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .light-mode .content-section:hover,
        .light-mode .related-post-item:hover {
            border-color: var(--primary);
        }

        .light-mode .features-list li {
            background-color: rgba(0, 206, 201, 0.05);
            border-left: 3px solid var(--secondary);
        }

        .light-mode .features-list li:hover {
            background-color: rgba(0, 206, 201, 0.1);
        }

        .light-mode .related-post-item h3 {
            color: var(--light-text);
        }

        .light-mode .related-post-item .category {
            color: var(--secondary);
        }

        .light-mode .related-post-item .version-size {
            color: var(--light-text-secondary);
        }

        .light-mode .back-btn {
            background-color: var(--light-card);
            color: var(--light-text);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .light-mode .back-btn:hover {
            color: white;
        }

        .light-mode .footer {
            background-color: #f1f3f5;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        .light-mode .footer::before {
            background: linear-gradient(135deg, rgba(108, 92, 231, 0.05), rgba(0, 206, 201, 0.05));
        }

        .light-mode .social-icon {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .light-mode .copyright {
            color: var(--light-text-secondary);
        }

        .light-mode .footer-links a {
            color: var(--light-text-secondary);
        }

        .light-mode .footer-links a:hover {
            color: var(--light-text);
            background-color: rgba(0, 0, 0, 0.05);
        }

        /* Scrollbar Styles */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        /* Responsive Adjustments */
        @media (max-width: 992px) {
            .screenshot-gallery {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            }
            
            .related-posts-grid {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 10px 15px;
            }

            #detail-image {
                width: 150px;
                height: 150px;
            }

            #detail-name {
                font-size: 1.5rem;
            }

            .details-section-title {
                font-size: 1.3rem;
            }

            .detail-grid {
                grid-template-columns: 1fr;
            }

            .screenshot-gallery {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }

            .related-posts-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }

            .footer-links {
                gap: 10px;
            }

            .social-icons {
                gap: 15px;
            }
        }

        @media (max-width: 576px) {
            .header .logo {
                font-size: 1.2rem;
            }

            #detail-image {
                width: 120px;
                height: 120px;
            }

            #detail-name {
                font-size: 1.3rem;
            }

            .details-section-title {
                font-size: 1.2rem;
            }

            .screenshot-gallery {
                grid-template-columns: repeat(2, 1fr);
            }

            .related-posts-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .footer-links {
                flex-direction: column;
                gap: 8px;
            }
        }

        /* Animation for content sections */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-section {
            animation: fadeInUp 0.6s both;
        }

        /* Delay animations for each section */
        .app-header { animation-delay: 0.1s; }
        .detail-grid:nth-child(1) { animation-delay: 0.2s; }
        .detail-grid:nth-child(2) { animation-delay: 0.3s; }
        .user-rating-container { animation-delay: 0.4s; }
        #detail-download-btn { animation-delay: 0.5s; }
        #mod-features-list { animation-delay: 0.6s; }
        #introduction-content { animation-delay: 0.7s; }
        #about-mod-content { animation-delay: 0.8s; }
        #screenshot-gallery { animation-delay: 0.9s; }
        #conclusion-content { animation-delay: 1.0s; }
        .related-posts-section { animation-delay: 1.1s; }
        .bottom-buttons { animation-delay: 1.2s; }
    </style>
</head>
<body class="dark-mode">

    <div class="header">
        <div class="left-section">
            <a href="index.html" class="logo">
                <i class="fas fa-root floating"></i>
                <span>APK Zone</span>
            </a>
        </div>
        <div class="right-section">
            <i class="fas fa-sun icon" id="mode-toggle-icon"></i>
        </div>
    </div>

    <div class="container">
        <div id="loading-indicator" class="loading-message">
            <i class="fas fa-spinner"></i>
            <div>Loading app details...</div>
        </div>
        <div id="error-message" class="error-message" style="display: none;"></div>

        <div id="app-detail-content" style="display: none;">
            <!-- App Header -->
            <div class="app-header animate-section">
                <img id="detail-image" src="" alt="App Poster">
                <h2 id="detail-name"></h2>
            </div>

            <!-- App Details Grid -->
            <h3 class="details-section-title animate-section">
                <i class="fas fa-info-circle"></i>
                <span>App Details</span>
            </h3>
            <div class="detail-grid animate-section">
                <div class="detail-item">
                    <i class="fas fa-mobile-alt"></i>
                    <div class="text">
                        <span class="label">App Name</span>
                        <span class="value" id="detail-grid-name"></span>
                    </div>
                </div>
                <div class="detail-item">
                    <i class="fas fa-code-branch"></i>
                    <div class="text">
                        <span class="label">Latest Version</span>
                        <span class="value" id="detail-grid-version"></span>
                    </div>
                </div>
                <div class="detail-item">
                    <i class="fas fa-clock"></i>
                    <div class="text">
                        <span class="label">Last Updated</span>
                        <span class="value" id="detail-last-updated"></span>
                    </div>
                </div>
                <div class="detail-item">
                    <i class="fas fa-building"></i>
                    <div class="text">
                        <span class="label">Publisher</span>
                        <span class="value" id="detail-publisher"></span>
                    </div>
                </div>
                <div class="detail-item">
                    <i class="fab fa-android"></i>
                    <div class="text">
                        <span class="label">Requirements</span>
                        <span class="value" id="detail-requirements"></span>
                    </div>
                </div>
                <div class="detail-item">
                    <i class="fas fa-tags"></i>
                    <div class="text">
                        <span class="label">Category</span>
                        <span class="value" id="detail-category"></span>
                    </div>
                </div>
            </div>

            <!-- Download Details Grid -->
            <h3 class="details-section-title animate-section">
                <i class="fas fa-download"></i>
                <span>Download Details</span>
            </h3>
            <div class="detail-grid animate-section">
                <div class="detail-item">
                    <i class="fas fa-database"></i>
                    <div class="text">
                        <span class="label">Size</span>
                        <span class="value" id="detail-size"></span>
                    </div>
                </div>
                <div class="detail-item">
                    <i class="fab fa-google-play"></i>
                    <div class="text">
                        <span class="label">Source</span>
                        <span class="value">Website / Direct</span>
                    </div>
                </div>
            </div>
            
            <!-- Google Play Button -->
            <div class="google-play-btn-container animate-section">
                <a href="#" id="google-play-link" target="_blank" style="display: none;">
                    <img src="https://play.google.com/intl/en_us/badges/images/badge_new.png" alt="Get it on Google Play" class="google-play-btn">
                </a>
            </div>

            <!-- User Rating -->
            <h3 class="details-section-title animate-section">
                <i class="fas fa-star"></i>
                <span>User Rating</span>
            </h3>
            <div class="user-rating-container animate-section">
                <div class="stars" id="user-rating-stars"></div>
                <span class="rating-count" id="user-rating-count"></span>
            </div>

            <!-- Download Button -->
            <div style="text-align: center;" class="animate-section">
                <button id="detail-download-btn">
                    <i class="fas fa-download"></i> Download (N/A)
                </button>
            </div>

            <!-- MOD Features -->
            <h3 class="details-section-title animate-section">
                <i class="fas fa-bolt"></i>
                <span>MOD Features</span>
            </h3>
            <div class="content-section animate-section">
                <ul class="features-list" id="mod-features-list">
                    <p class="info-message">No MOD features listed.</p>
                </ul>
            </div>

            <!-- Introduction Section -->
            <h3 class="details-section-title animate-section">
                <i class="fas fa-file-alt"></i>
                <span>Introduction</span>
            </h3>
            <div class="content-section animate-section" id="introduction-content">
                <p class="info-message">No introduction available.</p>
            </div>

            <!-- About This MOD -->
            <h3 class="details-section-title animate-section">
                <i class="fas fa-question-circle"></i>
                <span>About This MOD</span>
            </h3>
            <div class="content-section animate-section" id="about-mod-content">
                <p class="info-message">No description available.</p>
            </div>

            <!-- Recent Captures Section -->
            <h3 class="details-section-title animate-section">
                <i class="fas fa-images"></i>
                <span>Recent Captures</span>
            </h3>
            <div class="screenshot-gallery animate-section" id="screenshot-gallery">
                <p class="info-message">Loading screenshots...</p>
            </div>

            <!-- Conclusion Section -->
            <h3 class="details-section-title animate-section">
                <i class="fas fa-check-circle"></i>
                <span>Conclusion</span>
            </h3>
            <div class="content-section animate-section" id="conclusion-content">
                <p class="info-message">No conclusion available.</p>
            </div>

            <!-- Related Posts Section -->
            <h3 class="details-section-title animate-section">
                <i class="fas fa-thumbs-up"></i>
                <span>Related Posts</span>
            </h3>
            <div class="related-posts-section animate-section">
                <div class="related-posts-grid-placeholder">
                    <p>Loading related posts...</p>
                </div>
            </div>

            <!-- Back Button -->
            <div class="bottom-buttons animate-section">
                <button id="back-to-list-btn" class="back-btn">
                    <i class="fas fa-arrow-left"></i> Back to List
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Gallery -->
    <div id="gallery-modal">
        <span class="fas fa-times" id="modal-close-btn"></span>
        <div id="modal-content">
            <i class="fas fa-chevron-left modal-nav-btn" id="prev-screenshot-btn"></i>
            <img id="modal-image" src="" alt="App Screenshot">
            <i class="fas fa-chevron-right modal-nav-btn" id="next-screenshot-btn"></i>
        </div>
        <div id="image-counter"></div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="social-icons">
            <a href="https://www.instagram.com/apkz.one?igsh=YzBuaGVzaDRub3Ux" class="social-icon" target="_blank">
                <svg viewBox="0 0 24 24" style="fill:#e1306c">
                    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zM12 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                </svg>
            </a>
            <a href="https://youtube.com/@fullh.dmovie?si=edWEDi8PCx-Zj_sv" class="social-icon" target="_blank">
                <svg viewBox="0 0 24 24" style="fill:#ff0000">
                    <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/>
                </svg>
            </a>
            <a href="https://t.me/+mu8H74OWEV43OTNl" class="social-icon" target="_blank">
                <svg viewBox="0 0 24 24" style="fill:#0088cc">
                    <path d="M9.417 15.181l-.397 5.584c.568 0 .814-.244 1.109-.537l2.663-2.545 5.518 4.041c1.012.564 1.725.267 1.998-.931l3.622-16.972.001-.001c.321-1.496-.541-2.081-1.527-1.714l-21.29 8.151c-1.453.564-1.431 1.374-.247 1.741l5.443 1.693 12.643-7.911c.595-.394 1.136-.176.691.218z"/>
                </svg>
            </a>
        </div>
        <div class="copyright">
            © 2025 APK Zone. All Rights Reserved.
        </div>
        <div class="footer-links">
            <a href="Privacy.html">Privacy Policy</a>
            <a href="About Us.html">About Us</a>
            <a href="Contact.html">Contact Us</a>
            <a href="Term.html">Terms of Service</a>
        </div>
    </footer>

    <!-- Load Firebase config and services -->
    <script type="module">
        // Firebase SDKs को import karein
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js';
        import { getFirestore, doc, getDoc } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js';

        // आपकी Google Firebase project configuration (Embedded here)
        const firebaseConfig = {
          apiKey: "AIzaSyDXyZojvzlB7XQXOFw6n_kWK07mvtzVzYY",
          authDomain: "apps-1945d.firebaseapp.com",
          projectId: "apps-1945d",
          storageBucket: "apps-1945d.firebasestorage.app",
          messagingSenderId: "922330585425",
          appId: "1:922330585425:web:455c102287f072a78f1b70"
      };

    // Firebase को initialize करें
    const app = initializeApp(firebaseConfig);

    // Firestore service का instance प्राप्त करें
    const db = getFirestore(app);


    // --- Global variables for gallery state ---
    let allScreenshotUrls = []; // Array to hold all screenshot URLs for the current app
    let currentScreenshotIndex = -1; // Index of the currently displayed screenshot in the modal


    // --- DOM Elements ---
    const body = document.body; // Reference to the body for mode toggle
    const loadingIndicator = document.getElementById('loading-indicator');
    const errorMessageDiv = document.getElementById('error-message');
    const appDetailContentDiv = document.getElementById('app-detail-content'); // The main div containing all details

    const detailsPageTitle = document.getElementById('details-page-title'); // To update page title

    // App Details
    const detailImage = document.getElementById('detail-image');
    const detailName = document.getElementById('detail-name'); // This is the h2 name below the image
    const detailGridName = document.getElementById('detail-grid-name'); // Name in the "App Details" grid
    const detailGridVersion = document.getElementById('detail-grid-version'); // Version in the grid
    const detailLastUpdated = document.getElementById('detail-last-updated');
    const detailPublisher = document.getElementById('detail-publisher');
    const detailRequirements = document.getElementById('detail-requirements');
    const detailCategory = document.getElementById('detail-category'); // Category in the grid

    // Download Details
    const detailSize = document.getElementById('detail-size'); // Size in the grid
    const googlePlayLink = document.getElementById('google-play-link'); // Google Play button link

    // User Rating
    const userRatingStarsDiv = document.getElementById('user-rating-stars');
    const userRatingCountSpan = document.getElementById('user-rating-count');

    // Download Button
    const detailDownloadBtn = document.getElementById('detail-download-btn');

    // Introduction / Conclusion / About Section Content DIVs
    const introductionContentDiv = document.getElementById('introduction-content');
    const modFeaturesList = document.getElementById('mod-features-list');
    const aboutModContentDiv = document.getElementById('about-mod-content');
    const conclusionContentDiv = document.getElementById('conclusion-content');

    // Screenshot Gallery Element
    const screenshotGalleryDiv = document.getElementById('screenshot-gallery');

    // Modal Gallery Elements
    const galleryModal = document.getElementById('gallery-modal');
    const modalImage = document.getElementById('modal-image');
    const prevScreenshotBtn = document.getElementById('prev-screenshot-btn');
    const nextScreenshotBtn = document.getElementById('next-screenshot-btn');
    const modalCloseBtn = document.getElementById('modal-close-btn');
    const imageCounter = document.getElementById('image-counter');


    // Related Posts Elements
    const relatedPostsSection = document.querySelector('.related-posts-section'); // The section div
    const relatedPostsGridDiv = document.createElement('div'); // Create a new div for the actual grid
    relatedPostsGridDiv.classList.add('related-posts-grid'); // Add the grid class for styling
    const relatedPostsPlaceholder = document.querySelector('.related-posts-grid-placeholder'); // The placeholder div


    // Buttons
    const backToListBtn = document.getElementById('back-to-list-btn');


    // Mode Toggle Element (Header Icons)
    const modeToggleIcon = document.getElementById('mode-toggle-icon');
    // Search toggle icon is hidden by CSS on this page


    // --- Helper Functions ---

    // Function to show a specific content area and hide others
    function showContent(contentId) {
         loadingIndicator.style.display = 'none';
         errorMessageDiv.style.display = 'none';
         appDetailContentDiv.style.display = 'none';

         if (contentId === 'detail') {
             appDetailContentDiv.style.display = 'flex'; // Use flex for detail content container
         } else if (contentId === 'loading') {
             loadingIndicator.style.display = 'block';
         } else if (contentId === 'error') {
             errorMessageDiv.style.display = 'block';
         }
         // Scroll to the top of the container when content changes
         const container = document.querySelector('.container'); // Use the class name
          if(container) {
              container.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
    }

     // Function to render star rating
     function renderStars(rating, ratingCount) {
         userRatingStarsDiv.innerHTML = ''; // Clear existing stars
         // Ensure rating is a number between 0 and 5
         const validRating = Math.max(0, Math.min(5, parseFloat(rating) || 0));

         const fullStars = Math.floor(validRating);
         // Check for half star only if rating has a decimal part and is within the range
         const halfStar = validRating % 1 !== 0 && validRating > 0 && validRating < 5.0; // Corrected halfStar logic


         for (let i = 0; i < 5; i++) {
             const starIcon = document.createElement('i');
             starIcon.classList.add('fas'); // Font Awesome Solid

             if (i < fullStars) {
                 starIcon.classList.add('fa-star', 'filled'); // Full filled star
             } else if (i === fullStars && halfStar) {
                 // Use fa-star-half-alt for Font Awesome 5/6
                 starIcon.classList.add('fa-star-half-alt', 'filled'); // Half filled star
             } else {
                 starIcon.classList.add('fa-star'); // Empty star
             }
             userRatingStarsDiv.appendChild(starIcon);
         }

         userRatingCountSpan.textContent = `(${ratingCount || 0} ratings)`;
     }

     // Function to render a single related app item (similar to user.html item)
     function renderRelatedAppItem(app) {
         const appItem = document.createElement('div');
         appItem.classList.add('related-post-item'); // Use the specific class for related items

         // Build the inner HTML (similar to user.html app-item structure)
          let badgesHtml = '';
          // Example badges based on category or other data
           if ((app.category || '').toLowerCase() === 'games') { badgesHtml += `<span class="badge mod">MOD</span>`; } // Example MOD badge for Games category
           // if (true) { badgesHtml += `<span class="badge new">NEW</span>; } // Example: Always show NEW for related items? Or remove this.


          // Badges are not typically shown inside related posts in this design, commented out the badge container
          /*
          if (badgesHtml) { badgesHtml = `<div class="badges" style="position: static; display: block; text-align: right; margin-bottom: 5px;">${badgesHtml}</div>`; } // Adjust badge positioning for related item
          */


         appItem.innerHTML = `
             <div style="position: relative;"> <!-- Wrapper for badges (even if no badges) -->
                 <img src="${app.imageUrl || 'placeholder.png'}" alt="${app.name || 'App Image'}">
                 <!-- Badges can be added here if needed -->
             </div>
             <div class="item-details">
                 <h3>${app.name || 'Untitled App'}</h3>
                 <div class="category">${app.category || 'App'}</div>
                 <div class="version-size">
                     <span><i class="fas fa-bolt"></i> ${app.version || 'N/A'}</span>
                     <span><i class="fas fa-download"></i> ${app.size || 'N/A'}</span>
                 </div>
             </div>
         `;

         // Add click listener to navigate to the related app's details page
         appItem.addEventListener('click', () => {
             if (app.id) {
                 // Navigate to the related app's details page, reloading the page
                 window.location.href = `details.html?id=${app.id}`;
                 // Optional: Add a loading indicator here if navigation takes time
             }
         });

         return appItem; // Return the created DOM element
     }


     // Function to fetch and render related apps
     async function fetchAndRenderRelatedApps(relatedIds) {
         relatedPostsGridDiv.innerHTML = ''; // Clear previous related items
         // Hide placeholder and append the actual grid div if not already done
         if (relatedPostsPlaceholder && relatedPostsPlaceholder.parentNode) {
             relatedPostsPlaceholder.parentNode.insertBefore(relatedPostsGridDiv, relatedPostsPlaceholder);
             relatedPostsPlaceholder.style.display = 'none';
         } else if (!relatedPostsSection.contains(relatedPostsGridDiv)) {
             relatedPostsSection.appendChild(relatedPostsGridDiv); // Add the grid if section exists but no placeholder found
         }


         if (!relatedIds || relatedIds.length === 0) {
             relatedPostsGridDiv.innerHTML = '<p class="info-message" style="text-align: center;">No related apps listed.</p>';
             relatedPostsGridDiv.style.display = 'block'; // Show as block for the message
             return;
         }

         try {
             // Fetch all related app documents concurrently
             const relatedAppPromises = relatedIds.map(id => {
                 if (typeof id === 'string' && id.trim() !== '') { // Basic ID validation
                     return getDoc(doc(db, 'apps', id.trim()));
                 }
                 return Promise.resolve(null); // Return null for invalid IDs
             });

             const relatedAppSnaps = await Promise.all(relatedAppPromises);

             const relatedApps = relatedAppSnaps
                 .filter(snap => snap && snap.exists()) // Filter out nulls and non-existent docs
                 .map(snap => ({ id: snap.id, ...snap.data() })); // Map snapshots to data objects

             if (relatedApps.length === 0) {
                 relatedPostsGridDiv.innerHTML = '<p class="info-message" style="text-align: center;">Could not find any related apps for the given IDs.</p>';
                 relatedPostsGridDiv.style.display = 'block'; // Show as block for the message
                 return;
             }

             // Render the fetched related apps
             relatedApps.forEach(app => {
                 const appItemElement = renderRelatedAppItem(app); // Create the UI element
                 relatedPostsGridDiv.appendChild(appItemElement); // Add to the grid container
             });

             relatedPostsGridDiv.style.display = 'grid'; // Show as grid

         } catch (error) {
             console.error("Error fetching related apps: ", error);
             relatedPostsGridDiv.innerHTML = `<p class="error-message" style="text-align: center;">Error loading related apps: ${error.message}</p>`;
             relatedPostsGridDiv.style.display = 'block'; // Show as block for the message
         }
     }


    // --- Mode Toggle Functionality ---
    function toggleDarkMode() {
        const isLightMode = body.classList.contains('light-mode');
        if (isLightMode) {
            // Switch to Dark Mode
            body.classList.remove('light-mode');
            body.classList.add('dark-mode');
            modeToggleIcon.classList.remove('fa-moon'); // Change icon to sun
            modeToggleIcon.classList.add('fa-sun');
            localStorage.setItem('mode', 'dark'); // Save preference
        } else {
            // Switch to Light Mode
            body.classList.remove('dark-mode');
            body.classList.add('light-mode');
            modeToggleIcon.classList.remove('fa-sun'); // Change icon to moon
            modeToggleIcon.classList.add('fa-moon');
            localStorage.setItem('mode', 'light'); // Save preference
        }
    }

     // Apply saved mode on page load
     function applySavedMode() {
         const savedMode = localStorage.getItem('mode');
         if (savedMode === 'light') {
             body.classList.remove('dark-mode');
             body.classList.add('light-mode');
             modeToggleIcon.classList.remove('fa-sun');
             modeToggleIcon.classList.add('fa-moon');
         } else {
             // Default to dark mode if no preference saved or saved is 'dark'
             body.classList.remove('light-mode');
             body.classList.add('dark-mode');
             modeToggleIcon.classList.remove('fa-moon');
             modeToggleIcon.classList.add('fa-sun');
         }
     }

     // --- Modal Gallery Functions ---

     // Function to open the modal and display a specific screenshot
     function openScreenshotModal(index) {
         // Ensure allScreenshotUrls is correctly populated BEFORE calling this function
         if (!allScreenshotUrls || !Array.isArray(allScreenshotUrls) || allScreenshotUrls.length === 0 || index < 0 || index >= allScreenshotUrls.length) {
             console.warn("Invalid index or no screenshots available for modal.");
             return; // Do nothing if index is invalid or no screenshots
         }

         currentScreenshotIndex = index;
         modalImage.src = allScreenshotUrls[currentScreenshotIndex];
         updateModalContent(); // Update image, counter, and buttons
         galleryModal.style.display = 'flex'; // Show the modal
         body.style.overflow = 'hidden'; // Prevent scrolling the body when modal is open
     }

     // Function to close the modal
     function closeScreenshotModal() {
         galleryModal.style.display = 'none'; // Hide the modal
         body.style.overflow = ''; // Restore body scrolling
     }

     // Function to display the next screenshot
     function showNextScreenshot() {
         if (currentScreenshotIndex < allScreenshotUrls.length - 1) {
             currentScreenshotIndex++;
             modalImage.src = allScreenshotUrls[currentScreenshotIndex];
             updateModalContent();
         }
     }

     // Function to display the previous screenshot
     function showPreviousScreenshot() {
         if (currentScreenshotIndex > 0) {
             currentScreenshotIndex--;
             modalImage.src = allScreenshotUrls[currentScreenshotIndex];
             updateModalContent();
         }
     }

     // Function to update modal content (image, counter, buttons)
     function updateModalContent() {
         modalImage.src = allScreenshotUrls[currentScreenshotIndex];
         imageCounter.textContent = `Image ${currentScreenshotIndex + 1} of ${allScreenshotUrls.length}`;

         // Hide/Show navigation buttons
         prevScreenshotBtn.style.display = (currentScreenshotIndex === 0) ? 'none' : 'block';
         nextScreenshotBtn.style.display = (currentScreenshotIndex === allScreenshotUrls.length - 1) ? 'none' : 'block';
     }


    // --- Function to fetch and display single app detail ---
    async function fetchAndDisplayAppDetail(appId) {
        showContent('loading'); // Show loading indicator

        try {
            const appDocRef = doc(db, 'apps', appId);
            const appSnap = await getDoc(appDocRef);

            if (appSnap.exists()) {
                const appData = appSnap.data();

                // Populate DOM elements with app data
                detailsPageTitle.textContent = appData.name || 'App Details'; // Update page title
                detailImage.src = appData.imageUrl || 'placeholder.png';
                detailImage.alt = appData.name || 'App Image';
                detailName.textContent = appData.name || 'Untitled App'; // Main H2 name below the image
                detailGridName.textContent = appData.name || 'N/A'; // Name in the "App Details" grid
                detailGridVersion.textContent = appData.version || 'N/A';
                detailLastUpdated.textContent = appData.lastUpdated || 'N/A';
                detailPublisher.textContent = appData.publisher || 'N/A';
                detailRequirements.textContent = appData.requirements || 'N/A';
                detailCategory.textContent = appData.category || 'App'; // Category in the grid
                detailSize.textContent = appData.size || 'N/A'; // Size in grid


                // Handle Google Play link (Optional field)
                if (appData.playStoreUrl && appData.playStoreUrl.trim() !== '') {
                     googlePlayLink.href = appData.playStoreUrl;
                     googlePlayLink.style.display = 'inline-block'; // Show the link
                 } else {
                     googlePlayLink.style.display = 'none'; // Hide if no URL
                 }


                // Handle User Rating
                const userRating = parseFloat(appData.userRating) || 0; // Convert to number
                const ratingCount = parseInt(appData.ratingCount) || 0; // Convert to integer
                renderStars(userRating, ratingCount);


                // Set text for Download button
                detailDownloadBtn.textContent = `Download (${appData.size || 'N/A'})`;


                // Handle Download button URL
                const downloadUrl = appData.downloadUrl;
                if (downloadUrl && downloadUrl.trim() !== '' && downloadUrl.trim().toLowerCase() !== 'n/a') {
                    detailDownloadBtn.style.display = 'inline-block';
                     // Remove previous listener and add a new one to prevent duplicates
                     const newDownloadBtn = detailDownloadBtn.cloneNode(true);
                     detailDownloadBtn.parentNode.replaceChild(newDownloadBtn, detailDownloadBtn);
                     // Get the reference to the new button after replacement
                     const finalDownloadBtn = document.getElementById('detail-download-btn');

                    // *** NEW LOGIC: Attempt to trigger direct download ***
                    finalDownloadBtn.addEventListener('click', () => {
                         // Use an 'a' tag with download attribute to suggest direct download to the browser
                         const triggerLink = document.createElement('a');
                         triggerLink.href = downloadUrl;
                         // Adding the 'download' attribute suggests to the browser that this link should be downloaded
                         // You can optionally provide a filename suggestion: triggerLink.download = 'app.apk';
                         triggerLink.download = downloadUrl.split('/').pop() || 'download'; // Attempt to get filename from URL or use default

                         // Append to body, click, and remove
                         document.body.appendChild(triggerLink);
                         triggerLink.click();
                         document.body.removeChild(triggerLink);

                         // Note: This method RELIES on the downloadUrl being a DIRECT link to the file.
                         // It WILL NOT force a download if the URL leads to a webpage (like MediaFire's download page).
                         // In that case, the browser might navigate to that page instead of downloading the file.
                         console.log(`Attempting direct download for: ${downloadUrl}`);
                    });
                    // *** END NEW LOGIC ***


                } else {
                    detailDownloadBtn.style.display = 'none'; // Hide button if no valid URL
                }

                // Handle MOD Features (Requires modFeatures as an array of strings)
                const modFeatures = appData.modFeatures;
                modFeaturesList.innerHTML = ''; // Clear default message/previous features
                if (modFeatures && Array.isArray(modFeatures) && modFeatures.length > 0) {
                     modFeatures.forEach(feature => {
                         const li = document.createElement('li');
                         li.innerHTML = `<i class="fas fa-check-circle"></i> ${feature}`; // Checkmark icon
                         modFeaturesList.appendChild(li);
                     });
                } else {
                     modFeaturesList.innerHTML = '<p class="info-message">No MOD features listed.</p>'; // Show default message
                }

                // Handle Introduction (Requires introductionText field)
                 introductionContentDiv.innerHTML = ''; // Clear default message
                 if (appData.introductionText && appData.introductionText.trim() !== '') {
                     introductionContentDiv.innerHTML = `<p>${appData.introductionText.trim()}</p>`;
                 } else {
                      introductionContentDiv.innerHTML = '<p class="info-message">No introduction available.</p>';
                 }

                 // Handle About This MOD (Requires aboutMod field)
                 const aboutModText = appData.aboutMod;
                 aboutModContentDiv.innerHTML = ''; // Clear default message
                 if (aboutModText && aboutModText.trim() !== '') {
                     aboutModContentDiv.innerHTML = `<p>${aboutModText.trim()}</p>`; // Wrap text in paragraph
                 } else {
                     aboutModContentDiv.innerHTML = '<p class="info-message">No description available.</p>'; // Show default message
                 }

                 // --- Handle Screenshots & Prepare for Gallery ---
                 const screenshotUrls = appData.screenshotUrls;
                 allScreenshotUrls = []; // Clear global array for modal
                 screenshotGalleryDiv.innerHTML = ''; // Clear initial loading message or previous images

                 // Ensure screenshotUrls is a valid array before proceeding
                 if (screenshotUrls && Array.isArray(screenshotUrls) && screenshotUrls.length > 0) {
                      // Filter out any non-string or empty/whitespace URLs
                      allScreenshotUrls = screenshotUrls.filter(url => typeof url === 'string' && url.trim() !== '');

                      if (allScreenshotUrls.length > 0) {
                          allScreenshotUrls.forEach((url, index) => { // Use index in foreach
                               // Create thumbnail image
                               const img = document.createElement('img');
                               img.src = url; // Set the source from the valid URL
                               img.alt = `${appData.name || 'App'} Screenshot ${index + 1}`; // Descriptive alt text
                               img.classList.add('screenshot-item'); // Add class for styling
                               // Add a click listener to each thumbnail to open the modal
                               img.addEventListener('click', () => {
                                    // Open the modal with the clicked image's index
                                    openScreenshotModal(index);
                               });
                               // Optional: Handle image loading errors for thumbnails
                               img.onerror = () => {
                                   console.warn(`Failed to load screenshot thumbnail: ${url}`);
                                   // Replace broken image with a placeholder or remove it
                                   img.style.display = 'none'; // Hide the broken image
                                   // You might want to add a placeholder div here instead
                               };
                               screenshotGalleryDiv.appendChild(img); // Append thumbnail to the gallery div
                          });

                          // After trying to add all images, check if any valid ones were added
                          if (screenshotGalleryDiv.childElementCount === 0) {
                               // Case: screenshotUrls was an array, but none of the URLs resulted in a loaded image
                               screenshotGalleryDiv.innerHTML = '<p class="info-message">No screenshots loaded. Check URLs and Firebase Storage Rules.</p>';
                          }


                      } else {
                           // Case: screenshotUrls was an array, but contained only invalid items
                           screenshotGalleryDiv.innerHTML = '<p class="info-message">No valid screenshot URLs provided.</p>';
                      }
                 } else {
                      // Case: screenshotUrls field is missing, not an array, or is an empty array
                      screenshotGalleryDiv.innerHTML = '<p class="info-message">No screenshots available.</p>'; // Show default message
                 }


                  // Handle Conclusion (Requires conclusionText field)
                  const conclusionText = appData.conclusionText;
                  conclusionContentDiv.innerHTML = ''; // Clear default message
                   if (conclusionText && conclusionText.trim() !== '') {
                       conclusionContentDiv.innerHTML = `<p>${conclusionText.trim()}</p>`;
                   } else {
                        conclusionContentDiv.innerHTML = '<p class="info-message">No conclusion available.</p>';
                   }


                 // --- Handle Related Posts ---
                 const relatedAppIds = appData.relatedAppIds;
                 fetchAndRenderRelatedApps(relatedAppIds); // Call the function to fetch and display related apps


                showContent('detail'); // Show the populated detail content

            } else {
                // App with the given ID not found
                errorMessageDiv.textContent = 'App details not found for this ID.';
                showContent('error');
            }

        } catch (error) {
            console.error("Error fetching app detail: ", error);
            errorMessageDiv.textContent = `Error loading app details: ${error.message}. Check Firebase Config and Rules.`;
            showContent('error');
        }
    }


    // --- Event Listeners ---

    // Event listener for the Download button on the details page is now inside fetchAndDisplayAppDetail


    // Event listener for the Back to List button
    backToListBtn.addEventListener('click', () => {
        window.location.href = 'index.html'; // Navigate back to the user list page (assuming index.html is the main list page)
    });

    // Event listener for the Mode toggle icon (Sun/Moon)
    modeToggleIcon.addEventListener('click', toggleDarkMode);

    // --- Modal Gallery Event Listeners ---
     modalCloseBtn.addEventListener('click', closeScreenshotModal);
     prevScreenshotBtn.addEventListener('click', showPreviousScreenshot);
     nextScreenshotBtn.addEventListener('click', showNextScreenshot);

     // Close modal when clicking outside the image/buttons
     galleryModal.addEventListener('click', (event) => {
         // Check if the click occurred directly on the modal background (not the image or buttons inside modal-content)
         if (event.target === galleryModal) {
             closeScreenshotModal();
         }
     });

     // Close modal on Escape key press
     document.addEventListener('keydown', (event) => {
         if (event.key === 'Escape' && galleryModal.style.display === 'flex') {
             closeScreenshotModal();
         }
          // Optional: Add keyboard navigation for next/previous using arrow keys
          if (galleryModal.style.display === 'flex') { // Only navigate if modal is open
              if (event.key === 'ArrowRight') {
                  showNextScreenshot();
              } else if (event.key === 'ArrowLeft') {
                  showPreviousScreenshot();
              }
          }
     });

     // Optional: Add swipe functionality (more complex, requires touch event handling)
     // For simplicity, we'll stick to buttons and keys for now.


    // --- Initial Load ---
    applySavedMode(); // Apply theme first

    // Get the app ID from the URL query string
    const urlParams = new URLSearchParams(window.location.search);
    const appId = urlParams.get('id'); // Get the 'id' parameter

    if (appId) {
        // If an ID is found in the URL, fetch and display the app detail
        fetchAndDisplayAppDetail(appId);
    } else {
        // If no ID is found in the URL, show an error message
        errorMessageDiv.textContent = 'No app ID specified in the URL to load details.';
        showContent('error');
    }
    </script>

</body>
</html>
